!function(t){"use strict";function e(){var e=t(".ngl-gutenberg-pop");e.removeClass("is-open"),e.css({left:0,top:0}),e.find(".ngl-fallback").hide(),e.find("button.ngl-submenu-item").removeClass("is-active")}setTimeout(function(){t(".interface-interface-skeleton__content").on("scroll",function(){var e=t(".ngl-gutenberg-pop");if(e.hasClass("is-open")){if(t(".block-editor-block-toolbar").hasClass("is-showing-movers")){var a=t(".ngl-toolbar-mergetags").offset().top+t(".ngl-toolbar-mergetags").height()+24;t(".block-editor-block-toolbar").offset().left}else a=t(".block-editor-block-toolbar").offset().top+t(".ngl-toolbar-mergetags").height()+24,t(".block-editor-block-toolbar").offset().left;e.css({top:a+"px"})}})},1e3),t(document).on("click",".ngl-toolbar-mergetags",function(){var a=t(".ngl-gutenberg-pop");if(t(this).parents(".block-editor-block-toolbar").hasClass("is-showing-movers"))var n=t(this).offset().top+t(this).height()+24,s=t(this).offset().left;else n=t(this).parents(".block-editor-block-toolbar").offset().top+t(this).height()+24,s=t(this).offset().left;a.hasClass("is-open")?e():(a.addClass("is-open"),a.css({left:s+"px",top:n+"px"}))}),t("body").on("click",function(a){t(".ngl-gutenberg-pop");if(t(a.target).parents(".ngl-toolbar-mergetags").length||t(a.target).hasClass("ngl-toolbar-mergetags"))return!0;t(a.target).is(".ngl-gutenberg-pop")||t(a.target).parents(".ngl-gutenberg-pop").length||e()}),t(document).on("click",".ngl-submenu-trigger",function(){t(this).hasClass("is-triggered")?(t(this).parents("div[role=group]").find(".ngl-submenu-item").css({display:"none"}),t(this).parents("div[role=group]").find(".ngl-outside-helper").css({display:"none"}),t(this).removeClass("is-triggered"),t(this).find("svg").html('<path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"></path>'),t(".ngl-fallback").hide(),t(".ngl-submenu-item").removeClass("is-active")):(t(this).parents("div[role=group]").find(".ngl-submenu-item").css({display:"inline-flex"}),t(this).parents("div[role=group]").find(".ngl-outside-helper").css({display:"block"}),t(this).addClass("is-triggered"),t(this).find("svg").html('<path d="M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"></path>'))}),t(document).on("click",".ngl-submenu-item",function(){var a=t(this).attr("data-ngl-tag"),n=t(this).attr("data-tag-id"),s=t("input[type=text]#__fallback_"+n),l=wp.data.select("core/block-editor").getSelectedBlock(),i=t(this),r=Math.round((new Date).getTime()+100*Math.random());if(i.attr("data-require-fb")&1==i.attr("data-require-fb")&&""==s.val())return i.find(".ngl-gutenberg-icon").trigger("click"),s.addClass("is-mandatory"),!1;(e(),"unsubscribe_link"==n||"webversion"==n||"blog_post"==n||"update_preferences"==n)?a='<a href="'+a+'">'+(s.val()?s.val():t(this).attr("data-default-link-text"))+'</a><i class="ngl-tag-spacer" id="ngl-tag-spacer-'+r+'">&nbsp;</i>':(s.length&&(a=a.replace(" }}",",fallback="+s.val()+" }}")),a='<span class="ngl-tag">'+a+'</span><i class="ngl-tag-spacer" id="ngl-tag-spacer-'+r+'">&nbsp;</i>');var o=wp.data.select("core/block-editor").getSelectionStart().offset,g=wp.data.select("core/block-editor").getSelectionEnd().offset,c=l.attributes.content,d=wp.richText.create({html:c});d=wp.richText.insert(d,a,o,g),l.attributes.content=wp.richText.toHTMLString({value:d}).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),wp.data.dispatch("core/block-editor").updateBlock(l.clientId,l.attributes);var p=document.getElementById("ngl-tag-spacer-"+r),u=document.createRange(),f=window.getSelection();u.setStartAfter(p,0),u.collapse(!0),f.removeAllRanges(),f.addRange(u),p.focus()}),t(document).on("click",".ngl-gutenberg-icon",function(e){e.stopPropagation();var a=t(this).parents("button").attr("data-tag-id");t(".ngl-fallback:not([data-tag="+a+"])").hide(),t("button.ngl-submenu-item").removeClass("is-active"),t(".ngl-fallback[data-tag="+a+"]").is(":hidden")?(t(".ngl-fallback[data-tag="+a+"]").show(),t(".ngl-fallback[data-tag="+a+"]").find("input").focus(),t(this).parents("button").addClass("is-active")):(t(".ngl-fallback[data-tag="+a+"]").hide(),t(this).parents("button").removeClass("is-active"))}),t(document).on("keyup",".ngl-fallback-input input",function(e){if("Enter"===e.key||13===e.keyCode){var a=t(this).attr("data-tag-input-id"),n=t(".ngl-submenu-item[data-tag-id="+a+"]");if(t(this).hasClass("is-mandatory")&&""==t(this).val())return!1;n.trigger("click")}}),t(document).on("change",".ngl-fallback-input input",function(e){""!=t(this).val()?t(this).removeClass("is-mandatory"):t(this).addClass("is-mandatory")}),t(document).on("change",".ngl-fallback-input input[type=text]",function(){var e=t(this).attr("data-tag-input-id"),a=t(this).val(),n="action=newsletterglue_update_merge_tag&security="+newsletterglue_params.ajaxnonce+"&id="+e+"&value="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(){}})}),t(document).on("click",".type-ngl_pattern span.edit a",function(e){if(t(this).parents("td").find(".ngl-pattern-state").length){var a=t(this).parents("td").find(".row-actions");if(0==a.find(".ngl-pattern-row").length){e.preventDefault(),a.find("span.ngl_duplicate").addClass("ngl-bold");var n=newsletterglue_params.pattern_edit;return a.append(n),!1}}}),t(document).on("click",".ngl-pattern-bk",function(e){return e.preventDefault(),t(this).parents("td").find(".row-actions").find("span.ngl_duplicate").removeClass("ngl-bold"),t(this).parents(".ngl-pattern-row").remove(),!1}),t(".ngl-pattern-reset").show().insertBefore("#ajax-response"),t(document).on("click",".ngl-pattern-reset-toggle",function(e){e.preventDefault();var a=t(this).parents(".ngl-pattern-reset").find(".ngl-pattern-reset-ui");return a.is(":visible")?a.hide():a.show(),!1}),t(document).on("change",".ngl-pattern-reset-ui select",function(e){e.preventDefault();var a=t(this).find(":selected").attr("data-url");return t(this).parents(".ngl-pattern-reset-ui").find(".ngl-pattern-reset-start").attr("href",a),!1})}(jQuery);