jQuery.fn.selectText=function(){var t=document,e=this[0];if(t.body.createTextRange)(a=document.body.createTextRange()).moveToElementText(e),a.select();else if(window.getSelection){var a,l=window.getSelection();(a=document.createRange()).selectNodeContents(e),l.removeAllRanges(),l.addRange(a)}},function(t){"use strict";function e(e,a,l){e.find(".ngl-article-featured img").prop("src");var n={action:"newsletterglue_save_article_image",key:a,ids:l,security:newsletterglue_params.ajaxnonce};t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(t){t?(e.find(".ngl-article-featured img").prop("src",t.data.url),e.attr("data-attachment",t.data.id),e.find(".ngl-article-featured-edit i.trash").show()):(e.find(".ngl-article-featured img").prop("src",e.find(".ngl-article-featured img").attr("data-original-src")),e.attr("data-attachment",""),e.find(".ngl-article-featured-edit i.trash").hide())}})}function a(e,a=0){e.find(".ngl-articles-wrap .ngl-article:visible").each(function(){var a=e.find(".ngl-article:visible"),l=a.length-a.index(t(this));t(this).attr("data-key",l)});var l=e.attr("data-block-id"),n=[],r=[];e.find(".ngl-article").each(function(){var e=t(this).attr("data-key"),a=t(this).attr("data-post-id");n.push(e),r.push(a)});var i="action=newsletterglue_ajax_order_articles&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&keys="+n+"&values="+r+"&is_dup="+a;t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i})}function l(e){var a=e.parents(".ngl-embed").find(".ngl-embed-content"),l=e.parents(".ngl-embed").attr("data-block-id"),n=e.val(),r="action=newsletterglue_ajax_get_embed&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&url="+encodeURIComponent(n);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){a.empty()},success:function(t){t.error&&a.html('<div class="ngl-embed-error">'+t.error+"</div>"),t.html&&a.html(t.html)}})}if(t(document).on("click",".ngl-article-featured a",function(t){return t.preventDefault(),!1}),t(document).on("mouseenter",".ngl-article-featured",function(){var e=t(this).find(".ngl-article-featured-edit"),a=t(this).find("img");a.attr("src")==a.attr("data-original-src")?e.find("i.trash").hide():e.find("i.trash").show()}),t(document).on("click",".ngl-article-featured-edit i.image.outline.icon",function(a){var l,n;return a.preventDefault(),l=t(this).parents(".ngl-article"),n&&n.open(),(n=wp.media({title:newsletterglue_params.select_image,multiple:!1,library:{type:"image"}})).on("close",function(){var t=n.state().get("selection"),a=new Array,r=0;t.each(function(t){a[r]=t.id,r++});var i=a.join(",");l.attr("data-attachment",i),e(l,l.attr("data-post-id"),i)}),n.on("open",function(){var t=n.state().get("selection"),e=l.attr("data-attachment")?l.attr("data-attachment").split(","):"";e&&e.forEach(function(e){if(e){var a=wp.media.attachment(e);a.fetch(),t.add(a?[a]:[])}})}),n.open(),!1}),t(document).on("click",".ngl-article-featured-edit i.trash.outline.icon",function(a){return a.preventDefault(),e(t(this).parents(".ngl-article"),t(this).parents(".ngl-article").attr("data-post-id"),""),!1}),t(document).on("change","#ngl_embed_url",function(e){l(t(this))}),t(document).on("keyup","#ngl_embed_url",function(e){"Enter"!==e.key&&13!==e.keyCode||l(t(this))}),t(".ngl-embed-url").length)setInterval(function(){t(".ngl-embed-url").each(function(){var e=t(this),a=t(this).parents(".ngl-embed").find(".ngl-embed-content"),l=t(this).parents(".ngl-embed").find(".ngl-embed-error");""==e.val()||l.length||t.trim(a.html()).length||e.trigger("change")})},500);t(document).on("click",".ngl-article-add button",function(e){return e.preventDefault(),function(e){var a=e.attr("data-block-id"),l=e.attr("data-date_format"),n=e.find(".ngl_article_s").attr("data-post"),r=e.find(".ngl-article-placeholder");n||(n=e.find(".ngl_article_s").val());var i=e.find(".ngl-articles-wrap");if(i.find(".ngl-article").length)var s=parseInt(i.find(".ngl-article").first().attr("data-key"))+1;else s=1;var c="action=newsletterglue_ajax_add_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+a+"&key="+s+"&thepost="+encodeURIComponent(n)+"&date_format="+encodeURIComponent(l);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:c,beforeSend:function(){e.find(".ngl-articles-add .ngl-article-status").removeClass("ngl-article-error ngl-article-success").empty()},success:function(t){if(t.error&&(e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-error").html(t.error),e.find(".ngl_article_s").focus()),t.key){e.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-success").html(t.success),e.find(".ngl_article_s").val("").attr("data-post","");var a=r.clone();a.html(a.html().replace("{excerpt}",t.excerpt)),a.html(a.html().replace("{labels}",t.labels)),a.html(a.html().replace("{title}",t.title)),a.html(a.html().replace("{permalink}",t.permalink)),a.html(a.html().replace("{date}",t.date)),a.html(a.html().replace("{featured_image}",t.featured_image)),a.attr("data-post-id",t.post_id),a.attr("data-key",t.key),a.find(".ngl-article-featured a").attr("href",t.permalink),a.find(".ngl-article-featured img").attr("data-original-src",t.featured_image),a.prependTo(e.find(".ngl-articles-wrap")).removeClass("ngl-article-placeholder"),e.find(".ngl-article-list-empty").length&&e.find(".ngl-article-list-empty").hide(),e.find(".ngl-article-list-wrap").prepend(t.item),e.find(".ngl-article-list-empty").remove()}}})}(t(this).parents(".ngl-articles")),!1}),t(document).on("focus",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before",e.html()),e.html()==newsletterglue_params.write_labels&&e.html("")}).on("blur keyup paste input",".ngl-article-labels[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}).on("blur",".ngl-article-labels[contenteditable]",function(){const e=t(this);""==e.html()&&e.html(newsletterglue_params.write_labels)}),t(document).on("change",".ngl-article-labels[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),l="action=newsletterglue_ajax_update_labels&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&labels="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l})}),t(document).on("focus",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-excerpt[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-excerpt[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),l="action=newsletterglue_ajax_update_excerpt&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&excerpt="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l})}),t(document).on("click",".ngl-article-title a",function(t){return t.preventDefault(),!1}),t(document).on("focus",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-title span[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-title span[contenteditable]",function(){var e=t(this).parents(".ngl-articles"),a=t(this).parents(".ngl-article").attr("data-post-id"),l=t(this).parents(".ngl-article").attr("data-key"),n=t(this).html(),r="action=newsletterglue_ajax_update_title&security="+newsletterglue_params.ajaxnonce+"&post_id="+a+"&title="+encodeURIComponent(n);e.find(".ngl-article-list-item[data-key="+l+"] .ngl-article-list-title").html(n),t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r})});var n="";t(document).on("blur input keyup change",".ngl_article_s",function(){var e=t(this).val(),a=t(this).parents(".ngl-article-add").find(".ngl-article-suggest"),l="action=newsletterglue_ajax_search_articles&security="+newsletterglue_params.ajaxnonce+"&term="+encodeURIComponent(e);return function(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}(e)?(a.hide().empty(),n=null,!1):e.length<3?(a.hide().empty(),n=null,!1):n!=e&&(n=e,void t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(t){t.html?a.show().html(t.html):a.hide().empty()}}))}),t(document).on("click",".ngl-article-suggest li a",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-add"),l=t(this).attr("data-post-id");return a.find(".ngl_article_s").val(t(this).html()).attr("data-post",l),a.find(".ngl-article-suggest").empty().hide(),a.find("button").trigger("click"),!1}),t(document).on("click",".ngl-article-list-head",function(e){e.preventDefault();var a=t(this).parent().find(".ngl-article-list-wrap");return a.is(":visible")?(t(this).find("span").html("expand_less"),a.hide()):(t(this).find("span").html("expand_more"),a.show()),!1}),t(document).on("click",".ngl-article-list-refresh",function(e){e.preventDefault();var a=t(this),l=(t(this).html(),t(this).parents(".ngl-articles"),t(this).parents(".ngl-article")),n=t(this).parents(".ngl-articles").attr("data-block-id"),r=l.attr("data-key"),i=l.attr("data-post-id"),s="action=newsletterglue_ajax_clear_cache&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&key="+encodeURIComponent(r)+"&thepost="+encodeURIComponent(i);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){a.addClass("ngl-in-progress ngl-is-toggled"),l.find(".ngl-article-list-link").removeClass("ngl-is-toggled"),l.find(".ngl-article-list-url-edit").removeClass("ngl-show-state"),l.find(".ngl-article-state-refreshing").addClass("ngl-show-state"),l.find(".ngl-article-overlay").show()},success:function(t){a.removeClass("ngl-in-progress").addClass("ngl-in-done"),a.find("i").removeClass().addClass("check icon"),l.find(".ngl-article-state-refreshing").html(newsletterglue_params.refreshed_html).addClass("ngl-refreshed"),setTimeout(function(){l.find(".ngl-article-overlay").hide(),l.find(".ngl-article-state-refreshing").html(newsletterglue_params.refreshing_html).removeClass("ngl-show-state ngl-refreshed"),a.removeClass("ngl-in-done ngl-is-toggled"),a.find("i").removeClass().addClass("sync icon")},1e3),t&&(t.title&&l.find(".ngl-article-title span").html(t.title),t.featured_image&&l.find(".ngl-article-featured img").attr("src",t.featured_image),t.excerpt&&l.find(".ngl-article-excerpt").html(t.excerpt))}}),!1}),t(document).on("click",".ngl-article-overlay",function(e){var a=t(this).parents(".ngl-article"),l=t(this).parents(".ngl-article").find(".ngl-article-state-remove"),n=t(this).parents(".ngl-article").find(".ngl-article-list-url-edit");l.hasClass("ngl-show-state")?a.find(".ngl-article-list-delete").trigger("click"):n.hasClass("ngl-show-state")&&a.find(".ngl-article-list-link").trigger("click")}),t(document).on("click",".ngl-article-state-remove",function(e){if(e.preventDefault(),!t(this).hasClass("ngl-show-state"))return!1;var a=t(this).parents(".ngl-article"),l=t(this).parents(".ngl-articles").attr("data-block-id"),n=a.attr("data-key"),r="action=newsletterglue_ajax_remove_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(n);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r,beforeSend:function(){a.remove()},success:function(t){}}),!1}),t(document).on("click",".ngl-article-list-move-down a",function(e){e.preventDefault();var l=t(this).parents(".ngl-articles"),n=t(this).parents(".ngl-article"),r=(n.attr("data-key"),n.next());return 0!==r.length&&(n.insertAfter(r),a(l)),!1}),t(document).on("click",".ngl-article-list-move-up a",function(e){e.preventDefault();var l=t(this).parents(".ngl-articles"),n=t(this).parents(".ngl-article"),r=(n.attr("data-key"),n.prev());return 0!==r.length&&(n.insertBefore(r),a(l)),!1}),t(document).on("focus",".ngl-article-list-url-edit span[contenteditable]",function(){const e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-list-url-edit span[contenteditable]",function(){const e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("click",".ngl-article-list-url-edit a",function(e){e.preventDefault();t(this);var a=t(this).parent().find("span").html(),l=t(this).parents(".ngl-article"),n=t(this).parents(".ngl-articles").attr("data-block-id"),r=l.attr("data-key"),i=t(this).parents(".ngl-articles").attr("data-date_format"),s="action=newsletterglue_ajax_update_url&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&key="+encodeURIComponent(r)+"&url="+encodeURIComponent(a)+"&date_format="+encodeURIComponent(i);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){},success:function(t){l.find(".ngl-article-overlay").hide(),l.find(".ngl-article-list-url-edit").removeClass("ngl-show-state"),l.find(".ngl-article-list-link").removeClass("ngl-is-toggled"),t.success&&(l.find(".ngl-article-title span").html(t.data.title),l.find(".ngl-article-featured img").attr("src",t.data.featured_image),l.find(".ngl-article-excerpt").html(t.data.excerpt),l.find(".ngl-article-labels").html(t.data.labels),l.find(".ngl-article-date").html(t.data.date),l.attr("data-post-id",t.data.post_id),l.attr("data-key",t.data.key),l.find(".ngl-article-title a").attr("href",t.data.permalink),l.find(".ngl-article-featured a").attr("href",t.data.permalink),l.find(".ngl-article-featured img").attr("data-original-src",t.data.featured_image))},error:function(){}}),!1}),t(document).on("change",".ngl-article-list-url-edit span[contenteditable]",function(){t(this).parent().find("a").show()}),t(document).on("mouseleave",".ngl-article",function(e){t(this).find(".ngl-article-state-remove").hasClass("ngl-show-state")}),t(document).on("click",".ngl-article-list-link",function(e){e.preventDefault();var a=t(this).parents(".ngl-article"),l=a.find(".ngl-article-list-url-edit");return l.hasClass("ngl-show-state")?(a.find(".ngl-article-overlay").hide(),l.removeClass("ngl-show-state"),t(this).removeClass("ngl-is-toggled")):(a.find(".ngl-article-overlay").show(),l.addClass("ngl-show-state"),l.find("span").selectText(),t(this).addClass("ngl-is-toggled")),!1}),t(document).on("click",".ngl-article-list-delete",function(e){e.preventDefault();var a=t(this).parents(".ngl-article"),l=a.find(".ngl-article-state-remove");return l.hasClass("ngl-show-state")?(a.find(".ngl-article-overlay").hide(),l.removeClass("ngl-show-state"),a.find(".ngl-article-list-move, .ngl-article-list-refresh, .ngl-article-list-link").show(),t(this).removeClass("ngl-is-toggled")):(a.find(".ngl-article-overlay").show(),l.addClass("ngl-show-state"),a.find(".ngl-article-list-move, .ngl-article-list-refresh, .ngl-article-list-link").hide(),t(this).addClass("ngl-is-toggled")),!1});setInterval(function(){var e=t(".ngl_article_s");if(0==e.length)return!1;e.each(function(){var e=t(this).parents('div[data-type="newsletterglue/article"]').attr("data-block"),l=t(this).parents(".ngl-articles").attr("data-block-id"),n=t(this).parents(".ngl-articles"),r=wp.data.select("core/block-editor").getBlock(e);if("pattern"==(r&&r.attributes.scope?r.attributes.scope:"regular")&&typenow&&"ngl_pattern"!=typenow){var i=e.replace(/-/g,"");r.attributes.block_id=i,r.attributes.scope="regular",n.attr("data-block-id",i),wp.data.dispatch("core/block-editor").updateBlock(r.clientId,r.attributes),a(n,l),n.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-id").html("ID: "+i),n.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-scope").html("regular")}var s=t(this).parents(".ngl-articles").attr("data-block-id");if(t('.ngl-articles[data-block-id="'+s+'"]').length>1){var c=t('.ngl-articles[data-block-id="'+s+'"]:first'),d=t('.ngl-articles[data-block-id="'+s+'"]:last'),o=d.parents('div[data-type="newsletterglue/article"]').attr("data-block"),g=wp.data.select("core/block-editor").getBlock(o),u=o.replace(/-/g,"");g.attributes.block_id=u,d.attr("data-block-id",u),wp.data.dispatch("core/block-editor").updateBlock(g.clientId,g.attributes),a(d,c.attr("data-block-id")),d.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-id").html("ID: "+u)}})},100)}(jQuery);